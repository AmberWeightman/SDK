<!DOCTYPE html>
<html class="fuelux" lang="en" charset="utf-8">
  <head>
    <meta charset="utf-8">

    <title>UiNode.InjectAndRunJS - injecting JavaScript into web pages</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Screen scraping and UI automation software for desktop and web apps, Workflow to code in 1 click, 100% accuracy, extremely fast, excellent UI recognition">
	<meta name="keywords" content="UiPath Studio, ui automation, screen scraping, web scraping, data scraping, text capture, workflow automation, web automation, report mining">
	
	<!-- Le styles -->
	<link href="http://fuelcdn.com/fuelux/2.2/css/fuelux.css" rel="stylesheet" />
	<link href="http://fuelcdn.com/fuelux/2.2/css/fuelux-responsive.css" rel="stylesheet" />
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js" type="text/javascript"></script>
	<script src="http://fuelcdn.com/fuelux/2.2/loader.min.js" type="text/javascript"></script> 
    <link href="/css/docs.css" rel="stylesheet">
	<link href="/js/google-code-prettify/prettify.css" rel="stylesheet">	
	
	<link href="/css/syntax.css" rel="stylesheet">
	<link href="/css/style-v.4.css" rel="stylesheet">
	<link href="/css/fonts.css" rel="stylesheet">
	
    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/favicon.ico">    
  </head>
<body id="body" data-spy="scroll" data-target=".subnav" data-offset="50" style="background: none #f5f5f5;">
<div id="container" class="">
    <div id="header-container">
        <div id="header">
			<a href="/" class="link_logo" id="logo-link" alt="logo"><img src="/img/logo_small.png" class="logo_holder" alt=""><span id="header-logo-text">uipath</span></a>
			<span class="header_small_motto" id="header-motto">Understands User Interface</span>
			<div class="navigation">
				<ul>
					<li><a href="http://www.uipath.com/" title="Product Site">Product Site</a></li>
					<li><a href="https://github.com/Deskover/UiPath/wiki" title="Documentation Wiki">Documentation Wiki</a></li>
				</ul>
			</div>       
		</div>
    </div>
</div>


<div class="home_content">
	<h1 style="text-align: center;">UiNode.InjectAndRunJS - injecting JavaScript into web pages</h2>
	<div class="tab_description">	  		
		<div style="margin: 20px;">
			<h2>Overview</h2>

<p><a href="%5Bhttp://www.uipath.com/">UiPath</a> is a GUI-automation library which works on almost any UI framework from good old Win32 to WPF, Winforms, Java and HTML.</p>

<p>Today we’ll talk about web automation, more precisely about  <a href="https://github.com/Deskover/UiPath/wiki/Uinode#wiki-InjectAndRunJS">InjectAndRunJS</a> method in UiPath library. The method does exactly what is says: injects JavaScript code into a web page and executes it and gets back a result. Then we’ll quickly touch some general web-automation topics and we’ll play with some JScript code samples.</p>

<h2>Problem</h2>

<p>In today&#39;s web-centric world, automating the browser becomes more and more important. UiPath library provides full and consistent web-automation support for IE, Firefox and Chrome browsers.</p>

<p>With <a href="https://github.com/Deskover/UiPath/wiki/Uinode">UiNode</a> and <a href="https://github.com/Deskover/UiPath/wiki/UiBrowser">UiBrowser</a> library objects one can fully automate the browser. You can click any web control, fill out text, select items in combos and lists, extracting text and any HTML attribute value.</p>

<p>UiPath web automation is indeed very powerful but every automation step has a small performance cost because the automation code runs outside the browser process. Also, very complex web automation scenarios, there may be DOM things that are not (easily) available in UiPath library.</p>

<p>Here at <a href="http://www.deskover.com/">Deskover</a> we like to eat our own dog-food so we used InjectAndRunJS method to impelement other cool feature: <a href="https://github.com/Deskover/UiPath/wiki/Uinode#wiki-ExtractData">ExtractData</a> (which will be the subject of a future blog post).</p>

<h2>How to</h2>

<p>We’ll inject a script on google web page which alters the text of the search button and retrieves the original text.</p>

<p>Before getting into InjectAndRunJS we first need to have a UiNode object pointing to a web object. Here is how to start a IE browser and navigate to google search page:</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">UI_BROWSER_IE</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">WScript</span><span class="p">.</span><span class="nx">CreateObject</span><span class="p">(</span><span class="s2">&quot;UiPath.UiBrowser&quot;</span><span class="p">);</span>
<span class="nx">b</span><span class="p">.</span><span class="nx">Start</span><span class="p">(</span><span class="s2">&quot;http://www.google.com/&quot;</span><span class="p">,</span> <span class="nx">UI_BROWSER_IE</span><span class="p">);</span>
</code></pre></div>
<p>Inside the browser we’re looking for “Google search” button:</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">UI_FIND_DESCENDANTS</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">n</span> <span class="o">=</span> <span class="nx">b</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">FindFirst</span><span class="p">(</span><span class="nx">UI_FIND_DESCENDANTS</span><span class="p">,</span> <span class="s2">&quot;&lt;webctrl tag=&#39;button&#39; name=&#39;btnK&#39;/&gt;&quot;</span><span class="p">);</span>
</code></pre></div>
<p>You may wonder what the XML string is about. It is called <a href="https://github.com/Deskover/UiPath/wiki/Selector">Selector</a> but do not worry, there are tools to generate it automatically. It is time now to inject some JavaScript code that changes the text button and retrieves the original one:</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"> <span class="kd">var</span> <span class="nx">injectedJs</span> <span class="o">=</span> 
<span class="s2">&quot;function(e, newTxt) { \</span>
<span class="s2">    var oldTxt = e.innerText;\</span>
<span class="s2">    e.innerText = newTxt;\</span>
<span class="s2">    return oldTxt;\</span>
<span class="s2">}&quot;</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">InjectAndRunJS</span><span class="p">(</span><span class="nx">injectedJs</span><span class="p">,</span> <span class="s2">&quot;abc&quot;</span><span class="p">);</span>
<span class="nx">WScript</span><span class="p">.</span><span class="nx">Echo</span><span class="p">(</span><span class="nx">r</span><span class="p">);</span>
</code></pre></div>
<p>The injected code is provided as a string. Take care of quotes, apostrophe and escaping characters! You can also provide a filename containing the JavaScript code instead; the method will figure out by itself what its first parameters means.</p>

<p>The injected code consists of one anonymous function. Its first parameter is the HTML element for which InjectAndRunJS method was called (in our case is the search button). The second parameter is a string that will be passed to injected code. The result is the value returned by injected function; in our case it is the original text of the search button.</p>

<p>The code executes in the context of the web page. You have full access to DOM, window and document objects. In our case we have access to search button and we can modify its innerText while retrieving the original text.</p>

<h2>Conclusions</h2>

<p>Injecting JavaScript code into web pages is a powerful and flexible web automation tool. You should use it when dealing with complex web automation scenario with tight performance requirements.</p>

<p>I&#39;ll see you next time,</p>

<p>Adrian.</p>
 					
		</div>			
	</div>			
</div>		

<footer class="footer">
  <div class="container">
	<p class="pull-right">  |  <a href="#">Back to top</a>  |   </p>        
	<p>Page last generated on September 19, 2013</p>
  </div>
</footer>

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>    
   	<script src="/js/custom.js" type="text/javascript"></script>	

	<script type="text/javascript">
		/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
		var disqus_shortname = 'screenscraper'; // required: replace example with your forum shortname

		/* * * DON'T EDIT BELOW THIS LINE * * */
		(function () {
			var s = document.createElement('script'); s.async = true;
			s.type = 'text/javascript';
			s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
			(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
		}());
	</script>
	
	<!-- Google Analytics -->
	<script type="text/javascript">

	  var _gaq = _gaq || [];
	  _gaq.push(['_setAccount', 'UA-65056-8']);
	  _gaq.push(['_trackPageview']);

	  (function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	  })();

	</script>
  </body>
</html>
